#+STARTUP: logdone
#+TITLE: How to fix errors when transferring tUSDT to the exchange account?

* Purpose of the document

To fix the error ~exceeds block gas limit~ when sending tUSDT to the exchange account.

* TODO Is there a way to set the log output of geth to verbose?

* TODO Can we run geth in debug mode?

* TODO Is there JSON RPC call which will return the gas price?

* DONE Experiment 1
  CLOSED: [2021-12-31 Fri 13:50]

** DONE Step 1: Change gas ~gasLimit~ in ~genesis.json~ from ~0x47b760~ to ~0xffffff~ 
   CLOSED: [2021-12-31 Fri 13:28]

** DONE Step 2: Re-deploy the testnets
   CLOSED: [2021-12-31 Fri 13:43]
   
** DONE Step 3: Check whether or not the error still occurs
   CLOSED: [2021-12-31 Fri 13:43]

   Yes, it does.

* TODO Experiment 2

** DONE Step 1: Change gas ~gasLimit~ in ~genesis.json~ from ~0x47b760~ to ~0x000001~ 
   CLOSED: [2021-12-31 Fri 14:05]

0x47b760
0x000001
   
** DONE Step 2: Re-deploy the testnets
   CLOSED: [2021-12-31 Fri 14:18]
   
** DONE Step 3: Check whether or not the error still occurs
   CLOSED: [2021-12-31 Fri 14:18]

Now we get a different error: ~insufficient funds for gas * price + value~

~/Users/dp118m/dev/misc/go-ethereum/core/tx_pool.go~:

#+begin_src go
// Transactor should have enough funds to cover the costs
// cost == V + GP * GL
if pool.currentState.GetBalance(from).Cmp(tx.Cost()) < 0 {
	return ErrInsufficientFunds
}
#+end_src

** DONE How much ETH does the exchange account have?
   CLOSED: [2021-12-31 Fri 14:36]

0

* DONE How can I transfer some ETH to the exchange account?
  CLOSED: [2021-12-31 Fri 18:18]

Exchange ETH address: ~0x190FD61ED8fE0067f0f09EA992C1BF96209bab66~

** DONE What ETH transfer scripts do we have?
   CLOSED: [2021-12-31 Fri 18:18]

https://dpisarenko.com/posts/eth-transfers/  


* TODO Find out what "intrinsic gas too low" means

* TODO Search for the error message in the source code of ~go-ethereum~

** DONE What is the error message we are looking for?
   CLOSED: [2021-12-31 Fri 12:53]

~exceeds block gas limit~

** Protocol

#+begin_src 
ErrGasLimit = errors.New("exceeds block gas limit")
#+end_src

** TODO Search for ~ErrGasLimit~

~/Users/dp118m/dev/misc/go-ethereum/light/txpool.go~

#+begin_src go
header := pool.chain.GetHeaderByHash(pool.head)
if header.GasLimit < tx.Gas() {
	return core.ErrGasLimit
}
#+end_src

** Thought

How can I see the values of

 * ~header.GasLimit~ and
 * ~tx.Gas()~?

   
** Thought: Can we get ~pool.chain.GetHeaderByHash(pool.head)~ in Java or log output?

   
